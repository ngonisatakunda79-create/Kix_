<button onclick="startPayment()">Pay $1</button>

<iframe id="paynowFrame" style="display:none; width:100%; height:80vh;"></iframe>

<script>
async function startPayment() {
    const response = await fetch("/.netlify/functions/paynow", { method: "POST" });
    const data = await response.json();

    if (data.redirect) {
        document.getElementById("paynowFrame").src = data.redirect;
        document.getElementById("paynowFrame").style.display = "block";

        let pollUrl = data.poll;

        let interval = setInterval(async () => {
            let r = await fetch("/.netlify/functions/check-status?poll=" + pollUrl);
            let d = await r.json();

            if (d.paid === true) {
                clearInterval(interval);
                alert("Payment confirmed! Access unlocked.");
                window.location.href = "success.html";
            }
        }, 5000);
    } else {
        alert("Paynow error");
    }
}
</script>